# Bootstrap Node Mode Configuration
#
# This configuration enables Fukuii to run as a dedicated bootstrap node
# that accepts connections from genesis nodes and helps them sync.
#
# Based on investigation report recommendations (Priority 5).
#
# Usage:
#   ./bin/fukuii -Dconfig.file=bootstrap-node.conf etc

# Include base configuration
include "application.conf"

fukuii {
  # Node mode: bootstrap, full, or archive
  node-mode = "bootstrap"
  
  # Bootstrap mode specific settings
  bootstrap-mode {
    # Accept connections from genesis nodes (block 0)
    serve-genesis-nodes = true
    
    # Maximum concurrent connections from genesis nodes
    max-genesis-node-connections = 10
    
    # Serve blocks starting from this height
    # 0 = serve from genesis, use higher value to limit resource usage
    serve-blocks-from = 0
    
    # Maximum number of blocks to serve per request
    max-blocks-per-request = 128
    
    # Reduced blacklist duration for transient failures
    # Genesis nodes may disconnect/reconnect frequently
    transient-blacklist-duration = 60 seconds
    
    # Don't participate in block propagation (save resources)
    participate-in-propagation = false
    
    # Don't accept transactions (save resources)
    accept-transactions = false
  }
  
  # Network settings optimized for bootstrap node
  network {
    # Allow more incoming connections
    peer {
      max-incoming-peers = 50
      max-outgoing-peers = 10
      
      # More aggressive connection timeout for stuck peers
      connection-timeout = 30 seconds
      
      # Reduced blacklist duration (override)
      blacklist-duration = 120 seconds
    }
    
    # Bootstrap node discovery
    discovery {
      # Advertise as bootstrap node
      advertise-as-bootstrap = true
      
      # More frequent peer discovery
      discovery-interval = 30 seconds
    }
  }
  
  # Sync configuration for bootstrap node
  sync {
    # Don't perform fast sync (already synced)
    do-fast-sync = false
    
    # Regular sync to stay current
    do-regular-sync = true
    
    # More frequent status printing
    print-status-interval = 30 seconds
    
    # Serve historical blocks
    serve-historical-blocks = true
  }
  
  # Resource limits
  resource-limits {
    # Memory limits for serving requests
    max-concurrent-requests = 100
    max-cached-blocks = 1000
    
    # Bandwidth limits (bytes/sec)
    max-upload-bandwidth = 10485760  # 10 MB/s
    max-download-bandwidth = 5242880  # 5 MB/s
  }
  
  # Logging configuration for bootstrap mode
  logging {
    # More verbose peer connection logging
    peer-connections = "INFO"
    sync-progress = "INFO"
    
    # Log genesis node connections separately
    genesis-node-connections = "INFO"
  }
  
  # Metrics and monitoring
  metrics {
    # Enable metrics for bootstrap node monitoring
    enabled = true
    
    # Track bootstrap-specific metrics
    track-genesis-node-connections = true
    track-blocks-served = true
    track-bandwidth-usage = true
  }
}

# Pekko settings optimized for bootstrap node
pekko {
  actor {
    deployment {
      /peer-manager {
        # More actors for handling peer connections
        router = round-robin-pool
        nr-of-instances = 8
      }
    }
  }
  
  # HTTP server for RPC (optional)
  http {
    server {
      # Allow more concurrent connections
      max-connections = 100
      
      # Faster timeout for stuck connections
      idle-timeout = 60 seconds
    }
  }
}
