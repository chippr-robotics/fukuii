FROM fukuii-base:latest

# This "dev" image creates enough of a Fukuii build environment,
# so that the actual Fukuii images can be built in less time.
# We are particularly interested in caching the dependencies needed
# during the build process. This means that whenever those change,
# the "dev" image must be recreated.

# See the `Dockerfile-base` for the parent image details. 
# See the accompanying `build-dev.sh` script for tagging details.

ARG MANTIS_TAG
ENV MANTIS_TAG=${MANTIS_TAG:-develop}

USER root

ADD scripts/install-nix-apps-dev.sh  /home/fukuii/
ADD scripts/install-fukuii-dev.sh    /home/fukuii/
ADD scripts/install-fukuii.sh        /home/fukuii/

RUN chown fukuii:fukuii /home/fukuii/install-*.sh

USER fukuii
WORKDIR /home/fukuii
ENV USER=fukuii

RUN ~/install-nix-apps-dev.sh
RUN ~/install-fukuii-dev.sh $MANTIS_TAG
