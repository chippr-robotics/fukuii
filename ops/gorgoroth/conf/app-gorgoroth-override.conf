# Custom app.conf for gorgoroth network

# We include base.conf directly to avoid circular includes
# This is the base configuration file for the Fukuii ETC client.
include "conf/base/fukuii.conf"

# This where all the default settings are defined.
# It should always go at the top.
include "conf/base/pekko.conf"
include "conf/base/logging.conf"

# Load base testnet configuration (but skip its app.conf include since we're already in app.conf)
# We'll inline the necessary parts instead

# Force all network services (RPC, discovery binding, etc.) to listen on all interfaces inside the container.
# Without this, the node may bind JSON-RPC to localhost and be unreachable through Docker port publishing.
fukuii.network.server-address.interface = "0.0.0.0"

fukuii {
  sync {
    # Fast sync is disabled, requires coordination to see if it affects our deployments if we turn this on
    do-fast-sync = false

    # All testnet members are assumed to be honest so blacklisting is turned off
    blacklist-duration = 0
  }

  pruning {
    # Pruning is disabled as it's an experimental feature for now
    mode = "archive"
  }

  mining {
    coinbase = "0011223344556677889900112233445566778899" # will be overridden by gorgoroth.conf
    mining-enabled = false
    protocol = "pow"
  }

  network {
    discovery {
      # We assume a fixed cluster, so `bootstrap-nodes` must not be empty
      discovery-enabled = false

      # Listening interface for discovery protocol
      interface = ${fukuii.network.server-address.interface}
    }

    peer {
      # Override zero blacklist durations inherited through the configuration chain
      # (base-testnet.conf sets these to 0, which gets inherited here)
      # Use short durations to allow quick reconnection while still preventing connection spam
      short-blacklist-duration = 30.seconds
      long-blacklist-duration = 300.seconds

      wait-for-handshake-timeout = 15 seconds
    }

    rpc {
      http {
        enabled = true

        # Listening address/port of JSON-RPC HTTP endpoint
        interface = ${fukuii.network.server-address.interface}
        port = 8546

        # Domains allowed to query RPC endpoint.
        cors-allowed-origins = "*"
      }
    }
  }
}

# Now include gorgoroth-specific settings (from base-gorgoroth.conf)
fukuii {
  blockchains {
    network = "gorgoroth"

    # Gorgoroth chain definition
    # This keeps the network name "gorgoroth" (so the harness stays unchanged)
    # while aligning chain parameters/genesis with Mordor.
    #
    # IMPORTANT: We keep bootstrap-nodes empty to avoid reaching public Mordor
    # infrastructure. Static peering is managed by the gorgoroth harness.
    gorgoroth {
      network-id = 7

      pow-target-time = null

      frontier-block-number = "0"
      homestead-block-number = "0"
      eip106-block-number = "1000000000000000000"
      eip150-block-number = "0"
      eip155-block-number = "0"
      eip160-block-number = "0"
      eip161-block-number = "1000000000000000000"
      max-code-size = "24576"

      difficulty-bomb-pause-block-number = "0"
      difficulty-bomb-continue-block-number = "0"
      difficulty-bomb-removal-block-number = "0"

      byzantium-block-number = "1000000000000000000"
      atlantis-block-number = "0"
      agharta-block-number = "301243"
      phoenix-block-number = "999983"

      constantinople-block-number = "1000000000000000000"
      petersburg-block-number = "1000000000000000000"
      istanbul-block-number = "1000000000000000000"

      treasury-address = "0011223344556677889900112233445566778899"
      ecip1098-block-number = "1000000000000000000"
      ecip1097-block-number = "1000000000000000000"
      ecip1099-block-number = "2520000"

      muir-glacier-block-number = "1000000000000000000"
      magneto-block-number = "3985893"
      berlin-block-number = "1000000000000000000"
      mystique-block-number = "5520000"
      spiral-block-number = "9957000"

      dao = null
      account-start-nonce = "0"

      chain-id = "0x3f"
      custom-genesis-file = "/app/fukuii/conf/mordor-genesis.json"

      monetary-policy {
        first-era-block-reward = "5000000000000000000"
        first-era-reduced-block-reward = "3000000000000000000"
        first-era-constantinople-reduced-block-reward = "2000000000000000000"
        era-duration = 2000000
        reward-reduction-rate = 0.2
      }

      gas-tie-breaker = false
      eth-compatible-storage = true

      bootstrap-nodes = []

      bootstrap-checkpoints = [
        "9957000:0x159fd662290149137adfc05f6080ba0939e3814c9ee5dbe1eab8761ab4145724",
        "5520000:0x9d22fd69c7d8dbabc2b1b7199ac72585a3b979c519344f31fccf6124674803c4",
        "3985893:0xdcbe8dfd010fc78e3832967129a7689712ae9561d4260caa0f26790f67527fb9",
        "2520000:0x325646ff6ec1cfdf07674db5afb48956b62fe38bdc42c4f66d4abaaac2f0d11b",
      ]

      use-bootstrap-checkpoints = true

      mess {
        enabled = false
        decay-constant = 0.0001
        max-time-delta = 2592000
        min-weight-multiplier = 0.0001
      }
    }
  }

  network {
    discovery {
      # Discovery is disabled - using static peers only
      discovery-enabled = false
    }

    server-address {
      interface = "0.0.0.0"
      port = 30303
      apis = "eth,web3,net,personal,fukuii,debug,qa,checkpointing"
    }
  }

  mining {
    # Mining enabled for test network
    mining-enabled = false
    # Coinbase will be overridden per node
    coinbase = "0x1000000000000000000000000000000000000001"
    protocol = "pow"
  }

  sync {
    # Fast sync disabled for small test network
    do-fast-sync = false
    # SNAP sync disabled while focusing on regular sync behavior
    do-snap-sync = false
  }
}
