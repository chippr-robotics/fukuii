# Testbed Configuration - ETC Mainnet Fast Sync Testing
# This configuration re-enables the legacy fast sync pipeline to validate
# catch-up performance on the ETC public network and capture fast-sync logs.
# Focus is on verifying peer capability exchange, fast-sync progress, and timeouts.

# This is the base configuration file for the Fukuii ETC client.
include "conf/base/fukuii.conf"

# This where all the default settings are defined.
# It should always go at the top.
include "conf/base/pekko.conf"
include "conf/base/logging.conf"

# Keep logging at a geth-like baseline (INFO) so sync + node status is visible
# without flooding logs with per-message devp2p/RLPx traffic.
logging.logs-level = "INFO"

# Pekko defaults to DEBUG in conf/base/pekko.conf; pin it to INFO for this harness.
pekko.loglevel = "INFO"

# Dead-letter logging is very noisy at INFO during sync; disable it for this harness.
pekko.log-dead-letters = 0

fukuii {
  # Persist all Fukuii state (including node.key) on the mounted /app/data volume.
  # Without this override, the default datadir is ${user.home}/.fukuii/<network>,
  # which is not persisted by the cirith-ungol docker-compose harness.
  datadir = "/app/data"

  blockchains {
    # Load chain configs from the mounted filesystem directory so this harness
    # can override the built-in (classpath) chain configs shipped in the image.
    custom-chains-dir = "/app/conf/base/chains"

    # Network set to Mordor (ETC PoW testnet)
    network = "mordor"

    mordor {
      network-id = 7
      bootstrap-checkpoints = [
      # Spiral fork block (ECIP-1109) - activated at block 9,957,000
        "9957000:0x159fd662290149137adfc05f6080ba0939e3814c9ee5dbe1eab8761ab4145724",

        # Mystique fork block (ECIP-1104) - activated at block 5,520,000
        "5520000:0x9d22fd69c7d8dbabc2b1b7199ac72585a3b979c519344f31fccf6124674803c4",

        # Magneto fork block (ECIP-1103) - activated at block 3,985,893
        "3985893:0xdcbe8dfd010fc78e3832967129a7689712ae9561d4260caa0f26790f67527fb9",

        # ECIP-1099 block - activated at block 2,520,000
        "2520000:0x325646ff6ec1cfdf07674db5afb48956b62fe38bdc42c4f66d4abaaac2f0d11b",
      ]
    }

  }

  sync {
  # Enable SNAP sync to test the validation loop fix
  do-snap-sync = true
  do-fast-sync = true
  # Enable FastSync for ETC mainnet validation

    # Keep extended timeouts from previous test
    # These give peers more time to respond to fast sync requests
    peer-response-timeout = 90.seconds

    # Keep reduced blacklist durations from previous test
    # This allows faster retry if peers do get blacklisted
    blacklist-duration = 60.seconds

    # Keep reduced critical blacklist duration from previous test
    critical-blacklist-duration = 30.minutes

    snap-sync {
      # Extended timeout to capture full request lifecycle
      request-timeout = 60.seconds
    }
  }
  mining {
      # Miner's coinbase address
      # Also used in non-Ethash consensus.
      coinbase = "06612FfFf31eB0d56A1C694eb5F878ad6d850c16"

      # Extra data to add to mined blocks
      header-extra-data = "fukuii_at_cirith_ungol"

      # This determines how many parallel eth_getWork request we can handle, by storing the prepared blocks in a cache,
      # until a corresponding eth_submitWork request is received.
      #
      # Also used by the generic `BlockGenerator`.
      block-cache-size = 30

      # See io.iohk.ethereum.consensus.mining.Protocol for the available protocols.
      # Declaring the protocol here means that a more protocol-specific configuration
      # is pulled from the corresponding consensus implementation.
      # For example, in case of ethash, a section named `ethash` is used.
      # Available protocols: pow, mocked, restricted-pow
      # In case of mocked, remember to enable qa api
      protocol = pow

      # If true then the consensus protocol uses this node for mining.
      # In the case of ethash PoW, this means mining new blocks, as specified by Ethereum.
      # In the general case, the semantics are due to the specific consensus implementation.
      mining-enabled = false
    }
  network {
    discovery {
      # Ensure discovery stays enabled in this harness so we can pick up
      # external peers (not just the local Core-Geth sidecar).
      discovery-enabled = true

      # Make discovery iterate faster so we populate peers early (important
      # for SNAP pivot selection at startup).
      scan-interval = 10.seconds
    }

    rpc {
      http {
        # Bind RPC to all interfaces for testbed access from host machine
        # WARNING: Only use 0.0.0.0 in isolated test environments. Use 127.0.0.1 for production.
        interface = "0.0.0.0"
      }
    }

    peer {
      # Keep reduced short blacklist duration from previous test
      short-blacklist-duration = 2.minutes

      # Keep reduced long blacklist duration from previous test
      long-blacklist-duration = 30.minutes
    }
    
  }
}
